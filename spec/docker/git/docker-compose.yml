version: "3"

services:
  proxy-server:
    image: sameersbn/squid:3.5.27-2
    ports:
      - "3128:3128"
    volumes:
      - ../common_conf/squid.conf:/etc/squid/squid.conf
      - /srv/docker/squid/cache:/var/spool/squid


  git:
    depends_on:
      - proxy-server
    build: .
    volumes:
      - ../../../../swpro/bin:/home/user/swpro/bin
      - ../../../../swpro/configs:/home/user/swpro/configs
    command: >
      bash -c "
      cd swpro
      && sudo bin/swpro install
      && swpro set git http://proxy-server:3128
      && git clone https://github.com/takanotume24/swpro.git
      && swpro disable git
      && rm -r swpro
      && git clone https://github.com/takanotume24/swpro.git
      && swpro enable git
      && rm -r swpro
      && git clone https://github.com/takanotume24/swpro.git
      "